var Calendar;!function(e){var t=function(){function e(e){var t=this;this.$http=e,this["delete"]=function(e){return t.$http({method:"POST",url:"/task/deleteTask",data:{id:t._id},params:{id:e}})},this.addUser=function(e){return t.$http({method:"POST",url:"/task/addTaskUser",data:t,params:{id:e}})},this.removeUser=function(e){return t.$http({method:"POST",url:"/task/removeTaskUser",data:t,params:{id:e}})},this.set=function(e){t.title=e.title,t._id=e._id,t.start=e.start,t.color=e.color,t.user=e.user,t.finished=e.finished,t.description=e.description},this.update=function(e,s){return t.$http({method:"POST",url:s,data:t,params:{id:e}})},this.finish=function(e){return t.$http({method:"POST",url:"/task/finish",data:{task:t},params:{id:e}})}}return e.$inject=["$http"],e}();e.Event=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function t(t,s,r,n){var i=this;this.$http=t,this.avaible=s,this.selected=r,this.id=n,this.get=function(){return i.$http.get("/project/getProject").success(function(t,s){i.avaible=[],t.projects.forEach(function(t){var s=new e.Project(i.$http);s.set(t),i.avaible.push(s)}),i.id=i.avaible[i.selected]._id})},this.getUsers=function(){return i.avaible[i.selected]?i.avaible[i.selected].users:void 0},this.change=function(e){for(var t in i.avaible)i.avaible[t]._id===i.id&&(i.selected=i.avaible.indexOf(i.avaible[t]));i.avaible[i.selected]&&(i.owner=e===i.avaible[i.selected].owner)},this.select=function(t){i.newP=t,i.newP?i.selectedP=new e.Project(i.$http):i.selectedP=i.avaible[i.selected]},this.update=function(){var t="/project/";return t+=i.newP?"addProject":"modifyProject",i.selectedP.update(t).success(function(t,s){if(201==s){var r=new e.Project(i.$http);r.set(t.project),i.avaible.push(r),i.selected=i.avaible.length-1,i.id=r._id}})},this["delete"]=function(){return i.$http({method:"POST",url:"/project/deleteProject",data:{},params:{id:i.selectedP._id}}).success(function(e,t){i.avaible.splice(i.avaible.indexOf(i.selectedP,1)),i.avaible.length?(i.selected>i.avaible.length-1&&(i.selected-=1),i.id=i.avaible[i.selected]._id):(i.selected=0,i.id="")})}}return t.$inject=["$http","avaible","selected","id"],t}();e.ProjectList=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function e(e){var t=this;this.$http=e,this.set=function(e){t._id=e._id,t.title=e.title,t.owner=e.owner,t.users=e.users,t.description=e.description},this.update=function(e){return t.$http({method:"POST",url:e,data:{project:t},params:{id:t._id}})}}return e.$inject=["$http"],e}();e.Project=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function t(t,s,r,n,i){var a=this;this.$http=t,this.eventSources=s,this.tasks=r,this.finished=n,this.selectedTask=i,this.deleteTask=function(e){return a.selectedTask["delete"](e).success(function(){var e=a.tasks.indexOf(a.selectedTask);e>-1?a.tasks.splice(e,1):(e=a.finished.indexOf(a.selectedTask),e>-1&&a.finished.splice(e,1))})},this.getFreeTasks=function(t){return a.$http({method:"GET",url:"task/getFreeTask",params:{id:t}}).success(function(t,s){a.tasks=[],t.events.forEach(function(t){var s=new e.Event(a.$http);s.set(t),a.tasks.push(s)})})},this.getTasks=function(t){return a.$http({method:"GET",url:"task/getTasks",params:{id:t}}).success(function(t,s){a.eventSources=[],t.events.forEach(function(t){var s=new e.Event(a.$http);s.set(t),a.eventSources.push(s)})})},this.getFinished=function(t){return a.$http({method:"GET",url:"task/getFinished",params:{id:t}}).success(function(t,s){a.finished=[],t.events.forEach(function(t){var s=new e.Event(a.$http);s.set(t),a.finished.push(s)})})},this.removeUser=function(e){return a.selectedTask.removeUser(e).success(function(e,t){if(204==t){var s;a.eventSources.forEach(function(e){e._id===a.selectedTask._id&&(s=a.eventSources.indexOf(e))}),a.selectedTask.user="",a.eventSources[s].user="",a.tasks.push(a.eventSources[s]),a.eventSources.splice(s,1)}})},this.addUser=function(e,t){return a.selectedTask.addUser(e).success(function(e,s){if(204==s){a.selectedTask.user=t.name,a.selectedTask.color=t.color,a.eventSources.push(a.selectedTask);var r=a.tasks.indexOf(a.selectedTask);a.tasks.splice(r,1)}})},this.taskUser=function(e){return a.selectedTask.user===e},this.selectTask=function(t){t?a.newTask=!1:a.newTask=!0,a.newTask?a.selectedTask=new e.Event(a.$http):(a.selectedTask=t,a.selectedTask.start=new Date(a.selectedTask.start.toString()))},this.updateTask=function(t){var s="/task/";return s+=a.newTask?"addTask":"modifyTask",a.selectedTask.update(t,s).success(function(t,s){if(201===s){var r=new e.Event(a.$http);r.set(t.task),a.tasks.push(r)}})},this.finish=function(e){return a.selectedTask.finish(e).success(function(){if(a.selectedTask.finished){var e;a.eventSources.forEach(function(t){t._id===a.selectedTask._id&&(e=a.eventSources.indexOf(t))}),a.finished.push(a.eventSources[e]),a.eventSources.splice(e,1)}else{var t;a.finished.forEach(function(e){e._id===a.selectedTask._id&&(t=a.finished.indexOf(e))}),a.eventSources.push(a.finished[t]),a.finished.splice(t,1)}})}}return t.$inject=["$http","eventSources","tasks","finished","selectedTask"],t}();e.taskList=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function e(){var e=this;this.set=function(t){e._id=t._id,e.address=t.address,e.color=t.color,e.email=t.email,e.name=t.name,e.password=t.password},this.setHttp=function(t){return e.$http=t},this.update=function(){return e.$http({method:"POST",url:"/user/modifyUser",data:e})},this.changeColor=function(){return e.$http({method:"POST",url:"/user/changeColor",data:{color:e.color}})}}return e}();e.User=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function t(){var t=this;this.user=new e.User,this.login=function(e){t.authorized=!0,t.user.set(e)},this.updateUser=function(e){return t.user.set(e),t.user.update()},this.changeUserColor=function(e){return t.user.set(e),t.user.changeColor()},this.logout=function(){return t.authorized=!1},this.isAuthorized=function(){return t.authorized}}return t}();e.pageService=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function t(t,s,r){var n=this;this.$scope=t,this.$http=s,this.pageService=r,this.deleteTask=function(){return n.taskList.deleteTask(n.projects.id).success(function(){n.taskList.getTasks(n.projects.id).success(function(){return n.renderCalendar()}).error(function(e,t){401==t&&n.pageService.logout()});var e=angular.element("#task");e.modal("hide")}).error(function(e,t){401==t&&n.pageService.logout()})},this.selectChange=function(){n.selectedUsers=new Array,"add"===n.select?n.getAllUser():"remove"===n.select&&(n.allUser=new Array,n.projects.avaible[n.projects.selected].users.forEach(function(e){n.allUser.push(e)}))},this.select="add",this.addProjectUser=function(){n.$http({method:"POST",url:"/project/addUser",data:{users:n.selectedUsers},params:{id:n.projects.id}}).success(function(){n.selectedUsers.forEach(function(e){n.projects.avaible[n.projects.selected].users.push(e)}),n.selectedUsers=new Array;var e=angular.element("#add_user");e.modal("hide")}).error(function(e,t){401==t&&n.pageService.logout()})},this.removeProjectUser=function(){n.$http({method:"POST",url:"/project/deleteUser",data:{users:n.selectedUsers},params:{id:n.projects.id}}).success(function(){n.selectedUsers.forEach(function(e){n.selectedUsers.forEach(function(e){n.projects.avaible[n.projects.selected].users.forEach(function(t){return t===e?void n.projects.avaible[n.projects.selected].users.splice(n.projects.avaible[n.projects.selected].users.indexOf(e),1):void 0})})}),n.selectedUsers=new Array;var e=angular.element("#add_user");e.modal("hide")}).error(function(e,t){401==t&&n.pageService.logout()})},this.allUser=new Array,this.selectedUsers=new Array,this.selectUser=function(){n.selectedUsers.push(n.userName),n.allUser.splice(n.allUser.indexOf(n.userName),1),n.allUser.length?n.userName=n.allUser[0]:n.userName=""},this.getAllUser=function(){return n.$http({method:"GET",url:"/user/getAll"}).success(function(e){n.allUser=new Array,e.users.forEach(function(e){n.allUser.push(e.name)}),n.projects.avaible[n.projects.selected].users.forEach(function(e){n.allUser.forEach(function(t){return e===t?void n.allUser.splice(n.allUser.indexOf(t),1):void 0})}),n.allUser.splice(n.allUser.indexOf(n.user.name),1)}).error(function(e,t){401==t&&n.pageService.logout()})},this.finishTask=function(){n.taskList.finish(n.projects.id).success(function(){n.renderCalendar()}).error(function(e,t){401==t&&n.pageService.logout()})},this.getEvents=function(){n.getTasks(n.projects.id),n.getFreeTasks(n.projects.id),n.getFinishedTask(n.projects.id),n.projects.change(n.user.name),n.uiConfig.calendar.editable=n.projects.owner},this.deleteProject=function(){return n.projects["delete"]().success(function(e,t){var s=angular.element("#project");s.modal("hide"),n.getEvents()}).error(function(e,t){401==t&&n.pageService.logout()})},this.updateProject=function(){return n.projects.update().success(function(e,t){201===t&&n.getEvents();var s=angular.element("#project");s.modal("hide")}).error(function(e,t){401==t&&n.pageService.logout()})},this.selectProject=function(e){return n.projects.select(e)},this.taskList=new e.taskList(this.$http,new Array,new Array,new Array,new e.Event(this.$http)),this.changeProject=function(){n.projects.change(n.user.name),n.getProject()},this.projects=new e.ProjectList(this.$http,[],0,"0"),this.adminMenu=!1,this.pageService.user.setHttp(this.$http),this.user=this.pageService.user,this.updateUser=function(){return n.pageService.updateUser(n.user).success(function(){var e=angular.element("#userModal");e.modal("hide")}).error(function(e,t){401==t&&n.pageService.logout()})},this.renderCalendar=function(){var e=angular.element(document.querySelector("#calendar"));e.fullCalendar("removeEvents"),e.fullCalendar("addEventSource",n.taskList.eventSources)},this.updateTask=function(){return n.taskList.updateTask(n.projects.id).success(function(){var e=angular.element("#task");e.modal("hide"),n.taskList.getTasks(n.projects.id).success(function(){return n.renderCalendar()}).error(function(e,t){401==t&&n.pageService.logout()})}).error(function(e,t){401==t&&n.pageService.logout()})},this.eventClick=function(t){var s=angular.element("#task"),r=new e.Event(n.$http);r.set(t),n.taskList.selectTask(r),s.modal("show")},this.alertOnDrop=function(t,s,r){var i=new e.Event(n.$http);i.set(t),n.selectTask(i),n.updateTask()},this.uiConfig={calendar:{height:450,editable:this.projects.owner,header:{left:"month basicWeek basicDay",center:"title",right:"today prev,next"},eventSources:this.taskList.eventSources,dayClick:this.alertEventOnClick,eventDrop:this.alertOnDrop,eventClick:this.eventClick}},this.changeColor=function(){return n.pageService.changeUserColor(n.user).success(function(){n.taskList.eventSources.forEach(function(e){e.user==n.user.name&&(e.color=n.user.color,n.renderCalendar())})}).error(function(e,t){401==t&&n.pageService.logout()})},this.getFreeTasks=function(e){n.taskList.getFreeTasks(e).error(function(e,t){401==t&&n.pageService.logout()})},this.getTasks=function(e){return n.taskList.getTasks(e).success(function(){n.renderCalendar()}).error(function(e,t){401==t&&n.pageService.logout()})},this.getFinishedTask=function(e){return n.taskList.getFinished(e).error(function(e,t){401==t&&n.pageService.logout()})},this.getProject=function(){return n.projects.get().success(function(e,t){n.getEvents()}).error(function(e,t){401==t&&n.pageService.logout()})},this.selectTask=function(e){return n.taskList.selectTask(e)},this.removeUser=function(){return n.taskList.removeUser(n.projects.id).success(function(){return n.renderCalendar()}).error(function(e,t){401==t&&n.pageService.logout()})},this.addUser=function(){return n.taskList.addUser(n.projects.id,n.user).success(function(){return n.renderCalendar()}).error(function(e,t){401==t&&n.pageService.logout()})},this.taskUser=function(){return n.taskList.taskUser(n.user.name)},this.getProject()}return t.$inject=["$scope","$http","pageService"],t}();e.calendarCtrl=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function e(e,t,s,r,n){this.$scope=e,this.$http=t,this.$window=s,this.$location=r,this.pageService=n,this.login=!0}return e.prototype.loginPanel=function(){this.login=!0,this.reg=!1},e.prototype.regPanel=function(){this.login=!1,this.reg=!0},e.prototype.submit=function(){var e=this;if(this.login)var t="/user/login";else var t="/user/register";this.$http.post(t,this.user).success(function(t,s){console.log(s),200===s?(console.log(t),e.pageService.login(t.user)):401===s&&e.pageService.logout()})},e.$inject=["$scope","$http","$window","$location","pageService"],e}();e.loginCtrl=t}(Calendar||(Calendar={}));var Calendar;!function(e){var t=function(){function e(e,t,s){var r=this;this.$scope=e,this.pageService=t,this.$http=s,this.isAuthorized=this.pageService.isAuthorized,this.logout=function(){r.$http.post("/user/logout",FormData=null).success(function(e,t){200==t&&r.pageService.logout(),console.log(t)})},this.$http.get("/user/getUser").success(function(e){return r.pageService.login(e.user)}).error(function(){return r.pageService.logout()})}return e.$inject=["$scope","pageService","$http"],e}();e.pageCtrl=t}(Calendar||(Calendar={}));var Calendar;!function(e){function t(){e.calendar=new s(angular.module("calendar",["ui.calendar","ngMaterial","color.picker"]).controller("calendarCtrl",e.calendarCtrl).controller("loginCtrl",e.loginCtrl).controller("pageCtrl",e.pageCtrl).service("pageService",e.pageService))}var s=function(){function e(e){this.angularModule=e}return e.$inject=["angularModule"],e}();e.CalendarApp=s,e.start=t}(Calendar||(Calendar={}));